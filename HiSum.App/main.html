<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>HiSum &ndash; Hierarchical Summary for Hacker News &ndash; Pure</title>

    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
    <link rel="stylesheet" type="text/css" href="https://rawgithub.com/tilomitra/cssextras/master/css/pure-extras.css">
    <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/pure/0.6.0/menus-min.css">
    <link rel="stylesheet" href="css/layouts/menus.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <link rel="stylesheet" href="dist/themes/default/style.min.css" />
    <script src="dist/jstree.min.js"></script>
    <script type="text/javascript">



    </script>
    <style>
        ul {
            float: left;
            width: 100%;
            padding: 0;
            margin: 0;
            list-style-type: none;
        }

        li {
            display: inline;
        }

        blockquote {
            font-family: Georgia, serif;
            font-size: 18px;
            font-style: italic;
            /*width: 400px;*/
            margin: 0.25em 0;
            padding: 0.25em 40px;
            line-height: 1.45;
            position: relative;
            color: #383838;
        }

            blockquote:before {
                display: block;
                content: "\201C";
                font-size: 80px;
                position: absolute;
                left: -20px;
                top: -20px;
                color: #7a7a7a;
            }

            blockquote cite {
                color: #999999;
                font-size: 14px;
                display: block;
                margin-top: 5px;
            }

                blockquote cite:before {
                    content: "\2014 \2009";
                }
    </style>
    <script src="js/jsrender.js" type="text/javascript"></script>
    <script src="js/async.js"></script>
    <script type="text/javascript">
        $(function () {
            $.jstree.defaults.core.data = true;
        });
        function displayStories() {
            var stories = [];
            top100Function(100, function (error, result) {
                try {
                    if (error) console.log(error);
                    console.log(result);
                    result.forEach(function (entry) {
                        var story = { author: entry['Author'], title: entry['StoryTitle'], text: entry['StoryText'] ? entry['StoryText'].substring(1, 100) : '', storyid: entry['StoryId'], storyurl: entry['Url'], hdnstoryid: 'hdn' + entry['StoryId'], count: entry['StoryComments'], commentUrl: entry['CommentUrl'], storyurlwithquotes: '\'' + entry['Url'] + '\'', commenturlwithquotes: '\'' + entry['CommentUrl'] + '\'' };
                        stories.push(story);
                    });
                } catch (ex) {
                    alert(ex.toString());
                }
            });
            render(stories);
        }

        function displayArchive() {
            var stories = [];
            getArchiveFunction(100, function (error, result) {
                try {
                    if (error) console.log(error);
                    console.log(result);
                    result.forEach(function (entry) {
                        var story = { author: entry['Author'], title: entry['StoryTitle'], text: entry['StoryText'] ? entry['StoryText'].substring(1, 100) : '', storyid: entry['StoryId'], storyurl: entry['Url'], hdnstoryid: 'hdn' + entry['StoryId'], count: entry['StoryComments'], commentUrl: entry['CommentUrl'], storyurlwithquotes: '\'' + entry['Url'] + '\'', commenturlwithquotes: '\'' + entry['CommentUrl'] + '\'' };
                        stories.push(story);
                    });
                } catch (ex) {
                    alert(ex.toString());
                }
            });
            render(stories);
        }


        function render(stories) {
            $("#stories").html(
                $("#storyTemplate").render(stories)
            );
        }

        function renderSingleStory(stories) {
            $("#individualStories").prepend(
                $("#individualStoryTemplate").render(stories)
            );
        }

        $(document).ready(function () {
            $("#btnUpdate").click(displayStories);
        });

        function getStory() {
            try {
                var stories = [];
                var storytext = $('#inputStoryId').val();
                console.log(storytext);
                var storyidtext = storytext.split('=')[1];
                console.log(storyidtext);
                var storyidval = parseInt(storyidtext);
                console.log('storyid = ' + storyidval);
                storyFunction(storyidval, function (error, result) {
                    try {
                        if (error) console.log(error);
                        console.log(result);
                        result.forEach(function (entry) {
                            //var story = { author: entry['Author'], title: entry['StoryTitle'], text: entry['StoryText'] ? entry['StoryText'].substring(1, 100) : '', storyid: entry['StoryId'], storyurl: entry['Url'], hdnstoryid: 'hdn' + entry['StoryId'], count: entry['StoryComments'] };
                            var story = { author: entry['Author'], title: entry['StoryTitle'], text: entry['StoryText'] ? entry['StoryText'].substring(1, 100) : '', storyid: entry['StoryId'], storyurl: entry['Url'], hdnstoryid: 'hdn' + entry['StoryId'], count: entry['StoryComments'], commentUrl: entry['CommentUrl'], storyurlwithquotes: '\'' + entry['Url'] + '\'', commenturlwithquotes: '\'' + entry['CommentUrl'] + '\'' };
                            stories.push(story);
                        });
                    } catch (ex) {
                        alert(ex.toString());
                    }
                });
                renderSingleStory(stories);
            } catch (ex) {
                console.log(ex.toString());
            }
        }

        function loadStoryOnRefresh() {
            var storyidval = parseInt($("#hdnStoryId").html());
            loadStory(storyidval);
        }

        function archiveStory() {
            var storyidval = parseInt($("#hdnStoryId").html());
            archive(storyidval);
        }

        function loadStory(storyidval) {
            //var childid = "hdn" + $(item).attr("id");
            console.log(storyidval);
            try {
                tagCloudFunction(storyidval, function (error, result) {
                    if (error) console.log('error:' + error);
                    var json = result['Json'];
                    // preserve newlines, etc - use valid JSON
                    json = json.replace(/\\n/g, "\\n")
                                   .replace(/\\'/g, "\\'")
                                   .replace(/\\"/g, '\\"')
                                   .replace(/\\&/g, "\\&")
                                   .replace(/\\r/g, "\\r")
                                   .replace(/\\t/g, "\\t")
                                   .replace(/\\b/g, "\\b")
                                   .replace(/\\f/g, "\\f");
                    // remove non-printable and other non-valid JSON chars
                    json = json.replace(/[\u0000-\u0019]+/g, "");
                    //console.log(json);
                    var arr = JSON.parse(json);
                    var dict = result['Comments'];
                    var sentences = result['Sentences'];
                    console.log(sentences);
                    loadSentences(sentences);
                    loadTree(arr);
                    addLoadCommentEvent(dict);
                });
            } catch (ex) {
                alert(ex);
            }
        }

        function clicked(item) {
            $("#commentDiv").html('');
            var storyidval = parseInt($(item).attr("id"));
            $("#hdnStoryId").html(storyidval);
            loadStory(storyidval);
        }

        function loadSentences(sentences) {
            $("#sentencesDiv").html('');
            $.each(sentences, function (key, value) {
                console.log(value['Sentence']);
                var sentenceHtml = "<blockquote>" + value['Sentence'] + "</blockquote>";
                $("#sentencesDiv").append(sentenceHtml);
            });
        }

        function addLoadCommentEvent(dict) {
            var textdict = {};
            $.each(dict, function (key, value) {
                textdict[value['Id']] = value['Text'];
            });
            for (var property in textdict) {
                if (textdict.hasOwnProperty(property)) {
                    console.log(property);
                }
            }
            $('#jstree').on("select_node.jstree", function (e, data) {
                var key = data.node.id;
                console.log(key);
                loadComment(textdict, key);
            });
        }

        function loadComment(textdict, key) {
            $("#commentDiv").html('');
            $("#commentDiv").html(textdict[key]);
        }

        function loadTree(arr) {
            $("#jstree").jstree("destroy");
            $("#jstree").jstree({
                'core': {
                    'data': arr
                }
            });
        }

        function openurl(url) {
            console.log(url);
            var gui = require('nw.gui');
            gui.Shell.openExternal(url);
            if (!e) var e = window.event;
            e.cancelBubble = true;
            if (e.stopPropagation) e.stopPropagation();
        }
    </script>

    <!--[if lte IE 8]>
        <link rel="stylesheet" href="css/layouts/email-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="css/layouts/email.css">
    <!--<link rel="stylesheet" href="css/layouts/blog.css" />-->
    <!--<![endif]-->
    <!--[if lt IE 9]>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js"></script>
    <![endif]-->

    <script type="text/javascript" src="reader.js"></script>
</head>
<body>







    <div id="layout" class="content pure-g">
        <div id="nav" class="pure-u">
            <a href="#" class="nav-menu-button">Menu</a>

            <div class="nav-inner">
                <button id="btnUpdate" class="primary-button pure-button">Update</button>

                <div class="pure-menu pure-menu-open">
                    <ul>

                        <li><a href="#">Stories</a></li>
                        <li><a href="#" onclick="displayArchive();">Archive<span class="email-count">(2)</span></a></li>
                        <li><a href="#">Users</a></li>
                        <li><a href="#">WatchWords</a></li>
                        <li><a href="#">Trash</a></li>
                        <!--<li class="pure-menu-heading">Labels</li>
                        <li><a href="#"><span class="email-label-personal"></span>Personal</a></li>
                        <li><a href="#"><span class="email-label-work"></span>Work</a></li>
                        <li><a href="#"><span class="email-label-travel"></span>Travel</a></li>-->
                    </ul>
                </div>
            </div>
        </div>


        <div id="list" class="pure-u-1">
            <!--<div class="email-item email-item-selected pure-g">
                <div class="pure-u-3-4">
                    <h5 class="email-name">Author</h5>
                    <h4 class="email-subject">Title</h4>
                    <p class="email-desc">
                        Text
                    </p>
                </div>
            </div>-->
            <div id="divGetStory" class="email-item">
                <form class="pure-form">
                    <fieldset>
                        <legend>Get Individual story</legend>
                        <input id="inputStoryId" type="email" placeholder="Type URL from HackerNews" value="https://news.ycombinator.com/item?id=7568675">
                        <button type="submit" class="pure-button pure-button-primary" onclick=" getStory(); ">Get Story</button>
                    </fieldset>
                </form>
            </div>
            <div id="individualStories">

            </div>
            <div id="stories">

            </div>
        </div>
        <script id="individualStoryTemplate" type="text/x-jsrender">

            <div id={{>storyid}} class="email-item email-item-selected pure-g" onclick="clicked(this);">
                <div id="{{>hdnstoryid}}" style="display: none;">{{>storyurl}}</div>
                <div class="pure-u-3-4">
                    <h5 class="email-name">{{>author}}</h5><span class="pure-badge-info">{{>count}}</span>
                    <h4 class="email-subject">{{>title}}</h4>
                    <p class="email-desc">{{>text}}</p>
                    <div>
                        <ul>
                            <li>
                                <button onclick='openurl({{>storyurlwithquotes}});event.stopPropagation;' class="pure-button pure-button-primary">Link</button>
                            </li>
                            <li>
                                <button onclick='openurl({{>commenturlwithquotes}});event.stopPropagation;' class="pure-button pure-button-primary">Comments</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </script>
        <script id="storyTemplate" type="text/x-jsrender">

            <div id={{>storyid}} class="email-item email-item-selected pure-g" onclick="clicked(this);">
                <div id="{{>hdnstoryid}}" style="display: none;">{{>storyurl}}</div>
                <div class="pure-u-3-4">
                    <h5 class="email-name">{{>author}}</h5><span class="pure-badge-info">{{>count}}</span>
                    <h4 class="email-subject">{{>title}}</h4>
                    <p class="email-desc">{{>text}}</p>
                    <div>
                        <ul>
                            <li>
                                <button onclick='openurl({{>storyurlwithquotes}});event.stopPropagation;' class="pure-button pure-button-primary">Link</button>
                            </li>
                            <li>
                                <button onclick='openurl({{>commenturlwithquotes}});event.stopPropagation;' class="pure-button pure-button-primary">Comments</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </script>



        <div id="main" class="pure-u-1">
            <div class="email-content">

                <div class="email-content-header pure-g">

                    <div class="email-content-controls pure-u-1-2">
                        <div id="hdnStoryId" style="display:none"></div>
                        <button id="btnRefreshStory" class="secondary-button" onclick="loadStoryOnRefresh();">Refresh</button>
                        <button id="btnArchive" class="secondary-button pure-button" onclick="archiveStory();">Archive</button>
                    </div>
                </div>
                <!--<div class="email-content-header pure-g">
                    <div class="pure-u-1-2">
                        <h1 class="email-content-title">Hello from Toronto</h1>
                        <p class="email-content-subtitle">
                            From <a>Tilo Mitra</a> at <span>3:56pm, April 3, 2012</span>
                        </p>
                    </div>

                    <div class="email-content-controls pure-u-1-2">
                        <button id="btnReply" class="secondary-button pure-button">Reply</button>
                        <button class="secondary-button pure-button">Forward</button>
                        <button class="secondary-button pure-button">Move to</button>
                    </div>
                </div>-->

                <div class="email-content-body">
                    <br/>
                    <div class="pure-g">
                        <div class="pure-u-10-24">
                            <div id="sentencesDiv" style="width: 500px; height: 600px;white-space: pre-wrap">
                                &nbsp;
                            </div>
                        </div>
                        <div class="pure-u-2-24"></div>
                        <div class="pure-u-11-24">
                            <div id="jstree" style="width: 500px; height: 250px; overflow-x: auto;">&nbsp;</div>
                            <div id="commentDiv" style="width: 500px; height: 250px; overflow-x: auto; ">
                                &nbsp;
                            </div>
                        </div>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script src="http://yui.yahooapis.com/3.17.2/build/yui/yui-min.js"></script>

    <script>
        YUI().use('node-base', 'node-event-delegate', function (Y) {

            var menuButton = Y.one('.nav-menu-button'),
                nav = Y.one('#nav');

            // Setting the active class name expands the menu vertically on small screens.
            menuButton.on('click', function (e) {
                nav.toggleClass('active');
            });

            // Your application code goes here...

        });
    </script>


    <script>
        (function (root) {
            // -- Data --
            root.YUI_config = { "version": "3.17.2", "base": "http:\u002F\u002Fyui.yahooapis.com\u002F3.17.2\u002F", "comboBase": "http:\u002F\u002Fyui.yahooapis.com\u002Fcombo?", "comboSep": "&", "root": "3.17.2\u002F", "filter": "min", "logLevel": "error", "combine": true, "patches": [], "maxURLLength": 2048, "groups": { "vendor": { "combine": true, "comboBase": "\u002Fcombo\u002F1.17.30?", "base": "\u002F", "root": "\u002F", "modules": { "css-mediaquery": { "path": "vendor\u002Fcss-mediaquery.js" }, "handlebars-runtime": { "path": "vendor\u002Fhandlebars.runtime.js" } } }, "app": { "combine": true, "comboBase": "\u002Fcombo\u002F1.17.30?", "base": "\u002Fjs\u002F", "root": "\u002Fjs\u002F" } } };
            root.app || (root.app = {});
            root.app.yui = { "use": function () { return this._bootstrap('use', [].slice.call(arguments)); }, "require": function () { this._bootstrap('require', [].slice.call(arguments)); }, "ready": function (callback) { this.use(function () { callback(); }); }, "_bootstrap": function bootstrap(method, args) { var self = this, d = document, head = d.getElementsByTagName('head')[0], ie = /MSIE/.test(navigator.userAgent), callback = [], config = typeof YUI_config != "undefined" ? YUI_config : {}; function flush() { var l = callback.length, i; if (!self.YUI && typeof YUI == "undefined") { throw new Error("YUI was not injected correctly!"); } self.YUI = self.YUI || YUI; for (i = 0; i < l; i++) { callback.shift()(); } } function decrementRequestPending() { self._pending--; if (self._pending <= 0) { setTimeout(flush, 0); } else { load(); } } function createScriptNode(src) { var node = d.createElement('script'); if (node.async) { node.async = false; } if (ie) { node.onreadystatechange = function () { if (/loaded|complete/.test(this.readyState)) { this.onreadystatechange = null; decrementRequestPending(); } }; } else { node.onload = node.onerror = decrementRequestPending; } node.setAttribute('src', src); return node; } function load() { if (!config.seed) { throw new Error('YUI_config.seed array is required.'); } var seed = config.seed, l = seed.length, i, node; if (!self._injected) { self._injected = true; self._pending = seed.length; } for (i = 0; i < l; i++) { node = createScriptNode(seed.shift()); head.appendChild(node); if (node.async !== false) { break; } } } callback.push(function () { var i; if (!self._Y) { self.YUI.Env.core.push.apply(self.YUI.Env.core, config.extendedCore || []); self._Y = self.YUI(); self.use = self._Y.use; if (config.patches && config.patches.length) { for (i = 0; i < config.patches.length; i += 1) { config.patches[i](self._Y, self._Y.Env._loader); } } } self._Y[method].apply(self._Y, args); }); self.YUI = self.YUI || (typeof YUI != "undefined" ? YUI : null); if (!self.YUI && !self._injected) { load(); } else if (self._pending <= 0) { setTimeout(flush, 0); } return this; } };
            root.YUI_config || (root.YUI_config = {});
            root.YUI_config.seed = ["http:\u002F\u002Fyui.yahooapis.com\u002Fcombo?3.17.2\u002Fyui\u002Fyui-min.js"];
            root.YUI_config.groups || (root.YUI_config.groups = {});
            root.YUI_config.groups.app || (root.YUI_config.groups.app = {});
            root.YUI_config.groups.app.modules = { "start\u002Fapp": { "path": "start\u002Fapp.js", "requires": ["handlebars-runtime", "yui", "base-build", "router", "pjax-base", "view", "start\u002Fmodels\u002Fgrid", "start\u002Fviews\u002Finput", "start\u002Fviews\u002Foutput", "start\u002Fviews\u002Fdownload"] }, "start\u002Fmodels\u002Fgrid": { "path": "start\u002Fmodels\u002Fgrid.js", "requires": ["yui", "querystring", "base-build", "model", "model-sync-rest", "start\u002Fmodels\u002Fmq"] }, "start\u002Fmodels\u002Fmq": { "path": "start\u002Fmodels\u002Fmq.js", "requires": ["css-mediaquery", "attribute", "base-build", "model", "model-list"] }, "start\u002Fviews\u002Fdownload": { "path": "start\u002Fviews\u002Fdownload.js", "requires": ["yui", "base-build", "querystring", "view"] }, "start\u002Fviews\u002Finput": { "path": "start\u002Fviews\u002Finput.js", "requires": ["base-build", "start\u002Fmodels\u002Fmq", "start\u002Fviews\u002Ftab"] }, "start\u002Fviews\u002Foutput": { "path": "start\u002Fviews\u002Foutput.js", "requires": ["base-build", "escape", "start\u002Fviews\u002Ftab"] }, "start\u002Fviews\u002Ftab": { "path": "start\u002Fviews\u002Ftab.js", "requires": ["yui", "base-build", "view"] } };
        }(this));
    </script>
    <script>
        app.yui.use('node-base', 'node-event-delegate', function (Y) {
            // This just makes sure that the href="#" attached to the <a> elements
            // don't scroll you back up the page.
            Y.one('body').delegate('click', function (e) {
                e.preventDefault();
            }, 'a[href="#"]');
        });
    </script>






</body>
</html>
